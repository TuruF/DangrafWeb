<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Gestor de Nóminas</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.3/html2pdf.bundle.min.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 40px;
    }
    table {
      border-collapse: collapse;
      width: 100%;
      margin-top: 20px;
    }
    th, td {
      border: 1px solid #ccc;
      padding: 8px;
      text-align: left;
    }
    th {
      background-color: #f0f0f0;
    }
    select {
      padding: 5px;
      font-size: 14px;
    }
    button {
      padding: 6px 12px;
      background-color: #4CAF50;
      color: white;
      border: none;
      cursor: pointer;
    }
    button:hover {
      background-color: #45a049;
    }
  </style>
</head>
<body>

  <h2>Gestor de Nóminas</h2>

  <label for="mes">Filtrar por mes:</label>
  <select id="mes">
    <option value="Todos">Todos</option>
    <option value="Enero">Enero</option>
    <option value="Febrero">Febrero</option>
    <option value="Marzo">Marzo</option>
    <option value="Abril">Abril</option>
    <option value="Mayo">Mayo</option>
    <option value="Junio">Junio</option>
    <option value="Julio">Julio</option>
    <option value="Agosto">Agosto</option>
    <option value="Septiembre">Septiembre</option>
    <option value="Octubre">Octubre</option>
    <option value="Noviembre">Noviembre</option>
    <option value="Diciembre">Diciembre</option>
  </select>

  <table id="tablaNominas">
    <thead>
      <tr>
        <th>Empleado</th>
        <th>Mes</th>
        <th>Acción</th>
      </tr>
    </thead>
    <tbody>

    </tbody>
  </table>

  <!-- Contenido oculto para generar el PDF -->
  <div id="contenidoPDF" style="display:none;">
    <h3>Nómina</h3>
    <p><strong>Empleado:</strong> <span id="nombreEmpleado"></span></p>
    <p><strong>Mes:</strong> <span id="mesNomina"></span></p>
    <p><strong>Salario Base:</strong> <span id="salarioBase"></span></p>
    <p><strong>Complementos:</strong> <span id="complementos"></span></p>
    <p><strong>Antigüedad:</strong> <span id="antiguedad"></span></p>
    <p><strong>Descuentos:</strong> <span id="descuentos"></span></p>
    <p><strong>Total Neto:</strong> <span id="totalNeto"></span></p>
  </div>

  <script>
  const nominas = [
      { nombre: "Paula Díaz Martín", mes: "Enero", salarioBase: 1245, complementos: 50, antiguedad: 0, descuentos: 192.57 },
      { nombre: "Luis González Reyes", mes: "Enero", salarioBase: 1400, complementos: 0, antiguedad: 0, descuentos: 208.18 },
      { nombre: "Sara Martín Pérez", mes: "Enero", salarioBase: 1500, complementos: 60, antiguedad: 10, descuentos: 233.46 },
      { nombre: "David Fernández Lopez", mes: "Enero", salarioBase: 2500, complementos: 200, antiguedad: 10, descuentos: 402.98 },
      { nombre: "Raquel Sánchez González", mes: "Enero", salarioBase: 1245, complementos: 50, antiguedad: 0, descuentos: 192.57 },
      { nombre: "Antonio López Martínez", mes: "Enero", salarioBase: 1510, complementos: 40, antiguedad: 10, descuentos: 231.97 },
      { nombre: "Elena Ruíz García", mes: "Enero", salarioBase: 1245, complementos: 50, antiguedad: 0, descuentos: 192.57 },
      { nombre: "Paula Díaz Martín", mes: "Febrero", salarioBase: 1245, complementos: 50, antiguedad: 0, descuentos: 192.57 },
      { nombre: "Luis González Reyes", mes: "Febrero", salarioBase: 1400, complementos: 0, antiguedad: 0, descuentos: 208.18 },
      { nombre: "Sara Martín Pérez", mes: "Febrero", salarioBase: 1500, complementos: 60, antiguedad: 10, descuentos: 233.46 },
      { nombre: "David Fernández Lopez", mes: "Febrero", salarioBase: 2500, complementos: 200, antiguedad: 10, descuentos: 402.98 },
      { nombre: "Raquel Sánchez González", mes: "Febrero", salarioBase: 1245, complementos: 50, antiguedad: 0, descuentos: 192.57 },
      { nombre: "Antonio López Martínez", mes: "Febrero", salarioBase: 1510, complementos: 40, antiguedad: 10, descuentos: 231.97 },
      { nombre: "Elena Ruíz García", mes: "Febrero", salarioBase: 1245, complementos: 50, antiguedad: 0, descuentos: 192.57 },
      { nombre: "Paula Díaz Martín", mes: "Marzo", salarioBase: 1245, complementos: 50, antiguedad: 0, descuentos: 192.57 },
      { nombre: "Luis González Reyes", mes: "Marzo", salarioBase: 1400, complementos: 0, antiguedad: 0, descuentos: 208.18 },
      { nombre: "Sara Martín Pérez", mes: "Marzo", salarioBase: 1500, complementos: 60, antiguedad: 10, descuentos: 233.46 },
      { nombre: "David Fernández Lopez", mes: "Marzo", salarioBase: 2500, complementos: 200, antiguedad: 10, descuentos: 402.98 },
      { nombre: "Raquel Sánchez González", mes: "Marzo", salarioBase: 1245, complementos: 50, antiguedad: 0, descuentos: 192.57 },
      { nombre: "Antonio López Martínez", mes: "Marzo", salarioBase: 1510, complementos: 40, antiguedad: 10, descuentos: 231.97 },
      { nombre: "Elena Ruíz García", mes: "Marzo", salarioBase: 1245, complementos: 50, antiguedad: 0, descuentos: 192.57 },
      { nombre: "Paula Díaz Martín", mes: "Abril", salarioBase: 1245, complementos: 50, antiguedad: 0, descuentos: 192.57 },
      { nombre: "Luis González Reyes", mes: "Abril", salarioBase: 1400, complementos: 0, antiguedad: 0, descuentos: 208.18 },
      { nombre: "Sara Martín Pérez", mes: "Abril", salarioBase: 1500, complementos: 60, antiguedad: 10, descuentos: 233.46 },
      { nombre: "David Fernández Lopez", mes: "Abril", salarioBase: 2500, complementos: 200, antiguedad: 10, descuentos: 402.98 },
      { nombre: "Raquel Sánchez González", mes: "Abril", salarioBase: 1245, complementos: 50, antiguedad: 0, descuentos: 192.57 },
      { nombre: "Antonio López Martínez", mes: "Abril", salarioBase: 1510, complementos: 40, antiguedad: 10, descuentos: 231.97 },
      { nombre: "Elena Ruíz García", mes: "Abril", salarioBase: 1245, complementos: 50, antiguedad: 0, descuentos: 192.57 },
      { nombre: "Paula Díaz Martín", mes: "Mayo", salarioBase: 1245, complementos: 50, antiguedad: 0, descuentos: 192.57 },
      { nombre: "Luis González Reyes", mes: "Mayo", salarioBase: 1400, complementos: 0, antiguedad: 0, descuentos: 208.18 },
      { nombre: "Sara Martín Pérez", mes: "Mayo", salarioBase: 1500, complementos: 60, antiguedad: 10, descuentos: 233.46 },
      { nombre: "David Fernández Lopez", mes: "Mayo", salarioBase: 2500, complementos: 200, antiguedad: 10, descuentos: 402.98 },
      { nombre: "Raquel Sánchez González", mes: "Mayo", salarioBase: 1245, complementos: 50, antiguedad: 0, descuentos: 192.57 },
      { nombre: "Antonio López Martínez", mes: "Mayo", salarioBase: 1510, complementos: 40, antiguedad: 10, descuentos: 231.97 },
      { nombre: "Elena Ruíz García", mes: "Mayo", salarioBase: 1245, complementos: 50, antiguedad: 0, descuentos: 192.57 },
      { nombre: "Paula Díaz Martín", mes: "Junio", salarioBase: 1245, complementos: 50, antiguedad: 0, descuentos: 192.57 },
      { nombre: "Luis González Reyes", mes: "Junio", salarioBase: 1400, complementos: 0, antiguedad: 0, descuentos: 208.18 },
      { nombre: "Sara Martín Pérez", mes: "Junio", salarioBase: 1500, complementos: 60, antiguedad: 10, descuentos: 233.46 },
      { nombre: "David Fernández Lopez", mes: "Junio", salarioBase: 2500, complementos: 200, antiguedad: 10, descuentos: 402.98 },
      { nombre: "Raquel Sánchez González", mes: "Junio", salarioBase: 1245, complementos: 50, antiguedad: 0, descuentos: 192.57 },
      { nombre: "Antonio López Martínez", mes: "Junio", salarioBase: 1510, complementos: 40, antiguedad: 10, descuentos: 231.97 },
      { nombre: "Elena Ruíz García", mes: "Junio", salarioBase: 1245, complementos: 50, antiguedad: 0, descuentos: 192.57 },
      { nombre: "Paula Díaz Martín", mes: "Julio", salarioBase: 1245, complementos: 50, antiguedad: 0, descuentos: 192.57 },
      { nombre: "Luis González Reyes", mes: "Julio", salarioBase: 1400, complementos: 0, antiguedad: 0, descuentos: 208.18 },
      { nombre: "Sara Martín Pérez", mes: "Julio", salarioBase: 1500, complementos: 60, antiguedad: 10, descuentos: 233.46 },
      { nombre: "David Fernández Lopez", mes: "Julio", salarioBase: 2500, complementos: 200, antiguedad: 10, descuentos: 402.98 },
      { nombre: "Raquel Sánchez González", mes: "Julio", salarioBase: 1245, complementos: 50, antiguedad: 0, descuentos: 192.57 },
      { nombre: "Antonio López Martínez", mes: "Julio", salarioBase: 1510, complementos: 40, antiguedad: 10, descuentos: 231.97 },
      { nombre: "Elena Ruíz García", mes: "Julio", salarioBase: 1245, complementos: 50, antiguedad: 0, descuentos: 192.57 },
      { nombre: "Paula Díaz Martín", mes: "Agosto", salarioBase: 1245, complementos: 50, antiguedad: 0, descuentos: 192.57 },
      { nombre: "Luis González Reyes", mes: "Agosto", salarioBase: 1400, complementos: 0, antiguedad: 0, descuentos: 208.18 },
      { nombre: "Sara Martín Pérez", mes: "Agosto", salarioBase: 1500, complementos: 60, antiguedad: 10, descuentos: 233.46 },
      { nombre: "David Fernández Lopez", mes: "Agosto", salarioBase: 2500, complementos: 200, antiguedad: 10, descuentos: 402.98 },
      { nombre: "Raquel Sánchez González", mes: "Agosto", salarioBase: 1245, complementos: 50, antiguedad: 0, descuentos: 192.57 },
      { nombre: "Antonio López Martínez", mes: "Agosto", salarioBase: 1510, complementos: 40, antiguedad: 10, descuentos: 231.97 },
      { nombre: "Elena Ruíz García", mes: "Agosto", salarioBase: 1245, complementos: 50, antiguedad: 0, descuentos: 192.57 },
      { nombre: "Paula Díaz Martín", mes: "Septiembre", salarioBase: 1245, complementos: 50, antiguedad: 0, descuentos: 192.57 },
      { nombre: "Luis González Reyes", mes: "Septiembre", salarioBase: 1400, complementos: 0, antiguedad: 0, descuentos: 208.18 },
      { nombre: "Sara Martín Pérez", mes: "Septiembre", salarioBase: 1500, complementos: 60, antiguedad: 10, descuentos: 233.46 },
      { nombre: "David Fernández Lopez", mes: "Septiembre", salarioBase: 2500, complementos: 200, antiguedad: 10, descuentos: 402.98 },
      { nombre: "Raquel Sánchez González", mes: "Septiembre", salarioBase: 1245, complementos: 50, antiguedad: 0, descuentos: 192.57 },
      { nombre: "Antonio López Martínez", mes: "Septiembre", salarioBase: 1510, complementos: 40, antiguedad: 10, descuentos: 231.97 },
      { nombre: "Elena Ruíz García", mes: "Septiembre", salarioBase: 1245, complementos: 50, antiguedad: 0, descuentos: 192.57 },
      { nombre: "Paula Díaz Martín", mes: "Octubre", salarioBase: 1245, complementos: 50, antiguedad: 0, descuentos: 192.57 },
      { nombre: "Luis González Reyes", mes: "Octubre", salarioBase: 1400, complementos: 0, antiguedad: 0, descuentos: 208.18 },
      { nombre: "Sara Martín Pérez", mes: "Octubre", salarioBase: 1500, complementos: 60, antiguedad: 10, descuentos: 233.46 },
      { nombre: "David Fernández Lopez", mes: "Octubre", salarioBase: 2500, complementos: 200, antiguedad: 10, descuentos: 402.98 },
      { nombre: "Raquel Sánchez González", mes: "Octubre", salarioBase: 1245, complementos: 50, antiguedad: 0, descuentos: 192.57 },
      { nombre: "Antonio López Martínez", mes: "Octubre", salarioBase: 1510, complementos: 40, antiguedad: 10, descuentos: 231.97 },
      { nombre: "Elena Ruíz García", mes: "Octubre", salarioBase: 1245, complementos: 50, antiguedad: 0, descuentos: 192.57 },
      { nombre: "Paula Díaz Martín", mes: "Noviembre", salarioBase: 1245, complementos: 50, antiguedad: 0, descuentos: 192.57 },
      { nombre: "Luis González Reyes", mes: "Noviembre", salarioBase: 1400, complementos: 0, antiguedad: 0, descuentos: 208.18 },
      { nombre: "Sara Martín Pérez", mes: "Noviembre", salarioBase: 1500, complementos: 60, antiguedad: 10, descuentos: 233.46 },
      { nombre: "David Fernández Lopez", mes: "Noviembre", salarioBase: 2500, complementos: 200, antiguedad: 10, descuentos: 402.98 },
      { nombre: "Raquel Sánchez González", mes: "Noviembre", salarioBase: 1245, complementos: 50, antiguedad: 0, descuentos: 192.57 },
      { nombre: "Antonio López Martínez", mes: "Noviembre", salarioBase: 1510, complementos: 40, antiguedad: 10, descuentos: 231.97 },
      { nombre: "Elena Ruíz García", mes: "Noviembre", salarioBase: 1245, complementos: 50, antiguedad: 0, descuentos: 192.57 },
      { nombre: "Paula Díaz Martín", mes: "Diciembre", salarioBase: 1245, complementos: 50, antiguedad: 0, descuentos: 192.57 },
      { nombre: "Luis González Reyes", mes: "Diciembre", salarioBase: 1400, complementos: 0, antiguedad: 0, descuentos: 208.18 },
      { nombre: "Sara Martín Pérez", mes: "Diciembre", salarioBase: 1500, complementos: 60, antiguedad: 10, descuentos: 233.46 },
      { nombre: "David Fernández Lopez", mes: "Diciembre", salarioBase: 2500, complementos: 200, antiguedad: 10, descuentos: 402.98 },
      { nombre: "Raquel Sánchez González", mes: "Diciembre", salarioBase: 1245, complementos: 50, antiguedad: 0, descuentos: 192.57 },
      { nombre: "Antonio López Martínez", mes: "Diciembre", salarioBase: 1510, complementos: 40, antiguedad: 10, descuentos: 231.97 },
      { nombre: "Elena Ruíz García", mes: "Diciembre", salarioBase: 1245, complementos: 50, antiguedad: 0, descuentos: 192.57 }
    ];

    // Filtrado por mes
document.getElementById('mes').addEventListener('change', function () {
  const mesSeleccionado = this.value;
  const filas = document.querySelectorAll('#tablaNominas tbody tr');

  filas.forEach(fila => {
    // Mostrar todas las filas si "Todos" está seleccionado
    if (mesSeleccionado === "Todos" || fila.dataset.mes === mesSeleccionado) {
      fila.style.display = '';
    } else {
      fila.style.display = 'none';
    }
  });
});

    // Renderizar tabla de nóminas
    function renderTabla(data) {
      const tbody = document.querySelector('#tablaNominas tbody');
      tbody.innerHTML = '';

      data.forEach(nomina => {
        const tr = document.createElement('tr');
        tr.dataset.mes = nomina.mes;

        tr.innerHTML = `
          <td>${nomina.nombre}</td>
          <td>${nomina.mes}</td>
          <td><button onclick="descargarNomina('${nomina.nombre}', '${nomina.mes}', ${nomina.salarioBase}, ${nomina.complementos}, ${nomina.antiguedad}, ${nomina.descuentos})">Descargar PDF</button></td>
        `;

        tbody.appendChild(tr);
      });
    }

    // Descargar PDF de nómina
    function descargarNomina(nombre, mes, salarioBase, complementos, antiguedad, descuentos) {
      const totalNeto = salarioBase + complementos + antiguedad - descuentos;

      document.getElementById('nombreEmpleado').textContent = nombre;
      document.getElementById('mesNomina').textContent = mes;
      document.getElementById('salarioBase').textContent = salarioBase + " €";
      document.getElementById('complementos').textContent = complementos + " €";
      document.getElementById('antiguedad').textContent = antiguedad + " €";
      document.getElementById('descuentos').textContent = "-" + descuentos + " €";
      document.getElementById('totalNeto').textContent = totalNeto + " €";

      const contenido = document.getElementById('contenidoPDF');
      contenido.style.display = 'block';

      setTimeout(() => {
        html2pdf()
          .set({
            margin: 1,
            filename: `Nomina_${nombre}_${mes}.pdf`,
            image: { type: 'jpeg', quality: 0.98 },
            html2canvas: { scale: 2 },
            jsPDF: { unit: 'in', format: 'letter', orientation: 'portrait' }
          })
          .from(contenido)
          .save()
          .then(() => {
            contenido.style.display = 'none';
          });
      }, 0);
    }

    // Filtro por mes
    document.getElementById('mes').addEventListener('change', function () {
      const mesSeleccionado = this.value;
      const filas = document.querySelectorAll('#tablaNominas tbody tr');

      filas.forEach(fila => {
        if (mesSeleccionado === "Todos" || fila.dataset.mes === mesSeleccionado) {
          fila.style.display = '';
        } else {
          fila.style.display = 'none';
        }
      });
    });

    // Inicialización
    renderTabla(nominas);

fetch('/api/nominas')
  .then(response => response.json())
  .then(data => {
    renderTabla(data); // Usa los datos recibidos
  });
  

  </script>

</body>
</html>